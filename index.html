<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Roots of Renewal</title>
<style>
body { font-family: sans-serif; background: #f0f8ff; text-align: center; margin: 0; padding: 0; }
header { background: #228B22; color: white; padding: 10px; }
.resources { display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
.pill { background: #fff; color: #228B22; padding: 4px 8px; border-radius: 20px; font-weight: bold; font-size: 0.9em; min-width: 80px; text-align: center; }
button { margin: 6px 0; padding: 12px; font-size: 1em; border-radius: 8px; border: none; cursor: pointer; width: 90%; max-width: 400px; }
#scatterBtn { background: #32cd32; color: white; }
#prestigeBtn { background: #8b0000; color: white; }
.shop { margin-top: 15px; }
.shop h3 { margin: 12px 0 6px 0; font-size: 1.1em; }
.shop button { display: block; margin: 4px auto; }
.shop div { font-size: 0.9em; margin: 2px 0; }
#prestigeReport { background: #fff; padding: 12px; border: 2px solid #228B22; border-radius: 10px; margin: 12px auto; width: 90%; max-width: 450px; display: none; font-size: 0.95em; }
#journal { background: #fff8dc; border: 2px solid #deb887; border-radius: 10px; width: 95%; max-width: 500px; margin: 15px auto; padding: 8px; text-align: left; height: 250px; overflow-y: auto; font-size: 0.9em; }
#journal h3 { margin-top: 0; font-size: 1em; }
.entry, .plant-count, .pollinator-count { animation: fadeIn 0.6s ease-out; }
@keyframes fadeIn { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
@keyframes popIn { 0% { opacity: 0; transform: scale(0.6) rotate(-10deg); } 50% { transform: scale(1.1) rotate(5deg); } 100% { opacity: 1; transform: scale(1) rotate(0deg); } }
.new-sprout, .new-pollinator { display: inline-block; animation: popIn 0.6s ease-out; }
</style>
</head>
<body>
<header>
  <h1>ğŸŒ± Roots of Renewal</h1>
  <div class="resources">
    <div class="pill">ğŸŒ± Seeds: <span id="seeds">0</span></div>
    <div class="pill">ğŸŒ¿ Plants: <span id="plants">0</span></div>
    <div class="pill">ğŸ Pollinators: <span id="pollinators">0</span></div>
    <div class="pill">ğŸ¤² Stewardship: <span id="stewardship">0</span></div>
    <div class="pill">ğŸ§¬ Diversity: <span id="div">1.0</span>x</div>
    <div class="pill">ğŸ“š Eco Knowledge: <span id="eco">0</span>x</div>
    <div class="pill">ğŸï¸ Restored: <span id="restored">0</span> sq ft</div>
  </div>
</header>

<main>
  <button id="scatterBtn">Scatter Seeds ğŸŒ± +1</button>
  <div id="plantCounts"></div>
  <div id="pollinatorCounts"></div>
  <div class="shop" id="shopBody"></div>
  <button id="prestigeBtn">Rewild Land (Prestige)</button>
  <div id="prestigeReport"></div>
  <div id="journal">
    <h3>ğŸ““ Field Notes</h3>
    <div id="entries"></div>
  </div>
</main>

<script>
// --- State ---
let state={seeds:0,plants:{},pollinators:{},stewardship:0,ecoKnowledge:0,restored:0,newSprouts:[]};
let firstPlantPurchased=false, firstAutoPlantLogged=false;

// --- Plants & Pollinators ---
const PLANTS=[
  {name:"Purple Coneflower", cost:10, rate:1},
  {name:"Butterfly Milkweed", cost:30, rate:3},
  {name:"Little Bluestem", cost:60, rate:5},
  {name:"Prairie Blazing Star", cost:120, rate:10},
  {name:"White Wild Indigo", cost:50, rate:4},
  {name:"Rattlesnake Master", cost:80, rate:6},
  {name:"Hoary Vervain", cost:40, rate:3},
  {name:"Leadplant", cost:90, rate:7},
  {name:"Smooth Aster", cost:70, rate:5}
];
const POLLINATORS=[
  {name:"Monarch Butterfly", boost:0.2, host:"Butterfly Milkweed", food:"Prairie Blazing Star"},
  {name:"Rusty Patched Bumblebee", boost:0.4, host:"Purple Coneflower", food:"Prairie Blazing Star"},
  {name:"Hummingbird Clearwing Moth", boost:0.6, host:"Little Bluestem", food:"Butterfly Milkweed"},
  {name:"Eastern Swallowtail", boost:0.3, host:"White Wild Indigo", food:"Hoary Vervain"},
  {name:"Honeybee", boost:0.5, host:"Leadplant", food:"Prairie Blazing Star"},
  {name:"Bumblebee", boost:0.4, host:"Rattlesnake Master", food:"Smooth Aster"},
  {name:"Mason Bee", boost:0.2, host:"Hoary Vervain", food:"Little Bluestem"}
];
const LANDMARKS=[{size:100,label:"a backyard garden"},{size:1000,label:"a community park"},{size:10000,label:"a small prairie"},{size:100000,label:"a nature reserve"},{size:1000000,label:"a national park"}];

// --- Colors ---
const PLANT_COLORS={"Purple Coneflower":"#9b59b6","Butterfly Milkweed":"#e67e22","Little Bluestem":"#3498db","Prairie Blazing Star":"#e74c3c","White Wild Indigo":"#2ecc71","Rattlesnake Master":"#16a085","Hoary Vervain":"#8e44ad","Leadplant":"#f1c40f","Smooth Aster":"#d35400"};
const POLLINATOR_COLORS={"Monarch Butterfly":"#f39c12","Rusty Patched Bumblebee":"#d35400","Hummingbird Clearwing Moth":"#2ecc71","Eastern Swallowtail":"#9b59b6","Honeybee":"#f1c40f","Bumblebee":"#e74c3c","Mason Bee":"#3498db"};
const JOURNAL_COLORS={...PLANT_COLORS,...POLLINATOR_COLORS};

// --- Journal ---
function logEntry(text,species){
  const entries=document.getElementById("entries");
  const div=document.createElement("div");
  div.className="entry";
  div.textContent=text;
  if(species && JOURNAL_COLORS[species]){div.style.color=JOURNAL_COLORS[species]; div.style.fontWeight="bold";}
  entries.appendChild(div);
  entries.scrollTop=entries.scrollHeight;
}

// --- Scatter Seeds ---
function scatter(){ state.seeds+=1; render(); }

// --- Buy Plant ---
function buyPlant(plant){
  if(state.seeds>=plant.cost){
    state.seeds-=plant.cost;
    state.plants[plant.name]=(state.plants[plant.name]||0)+1;
    if(!firstPlantPurchased){
      logEntry(`ğŸŒ¿ You planted your first ${plant.name}! Life is beginning to take hold.`, plant.name);
      firstPlantPurchased=true;
    }
    render();
  }
}

// --- Pollinator Check (Scaled by host/food counts) ---
function checkPollinators(){
  POLLINATORS.forEach(pol=>{
    const hostCount=state.plants[pol.host]||0;
    const foodCount=state.plants[pol.food]||0;
    const maxAllowed=Math.min(hostCount,foodCount);
    const currentCount=state.pollinators[pol.name]||0;
    if(currentCount<maxAllowed){
      const probability=(hostCount+foodCount)/20;
      if(Math.random()<probability){
        state.pollinators[pol.name]=currentCount+1;
        logEntry(`ğŸ ${pol.name} has arrived!`, pol.name);
        const pollDivs=document.getElementById("pollinatorCounts").children;
        for(let d of pollDivs){ if(d.textContent.includes(pol.name)){ d.classList.add("new-pollinator"); }}
      }
    }
  });
}

// --- Weighted Random Plant Selection ---
function choosePlantByWeight(plants){
  let totalWeight=plants.reduce((sum,p)=>sum+(1/p.cost),0);
  let rand=Math.random()*totalWeight;
  for(let plant of plants){ rand-=(1/plant.cost); if(rand<=0) return plant; }
  return plants[plants.length-1];
}

// --- Prestige / Rewild ---
function prestige(){
  let addedRestored=Math.floor(state.stewardship*2+Object.values(state.plants).reduce((a,b)=>a+b,0)*5);
  state.restored+=addedRestored;
  state.ecoKnowledge+=1;
  let comparison=LANDMARKS.reduce((acc,mark)=>{if(state.restored>=mark.size) acc=mark.label; return acc;}, "a patch of wildflowers");
  document.getElementById("prestigeReport").innerHTML=`<h3>ğŸŒ Rewilding Complete!</h3>
    <p>You restored <b>${addedRestored.toLocaleString()}</b> sq ft this run.</p>
    <p>Total restored: <b>${state.restored.toLocaleString()}</b> sq ft â€” about the size of ${comparison}.</p>
    <p>Your work inspires others, earning <b>+1 Eco Knowledge</b>.</p>`;
  document.getElementById("prestigeReport").style.display="block";
  logEntry(`ğŸ“– Rewilding complete! This run restored ${addedRestored.toLocaleString()} sq ft. Total restored: ${state.restored.toLocaleString()} sq ft â€” roughly the size of ${comparison}.`);
  state.seeds=0; state.plants={}; state.pollinators={}; state.stewardship=0; firstPlantPurchased=false; firstAutoPlantLogged=false; state.newSprouts=[];
  document.getElementById("entries").innerHTML="";
  render();
}

// --- Plant Counts ---
function renderPlantCounts(){
  const div=document.getElementById("plantCounts");
  div.innerHTML="<h3>ğŸŒ¿ Plant Counts</h3>";
  PLANTS.forEach(plant=>{
    const count=state.plants[plant.name]||0;
    const d=document.createElement("div");
    d.textContent=`${plant.name}: ${count}`;
    d.style.color=PLANT_COLORS[plant.name]||"#000"; d.style.fontWeight="bold";
    if(count>0 && state.newSprouts.includes(plant.name)){ d.classList.add("new-sprout"); }
    div.appendChild(d);
  });
  state.newSprouts=[];
}

// --- Pollinator Counts ---
function renderPollinatorCounts(){
  const div=document.getElementById("pollinatorCounts");
  div.innerHTML="<h3>ğŸ Pollinator Counts</h3>";
  POLLINATORS.forEach(pol=>{
    const count=state.pollinators[pol.name]||0;
    const d=document.createElement("div");
    d.textContent=`${pol.name}: ${count}`;
    d.style.color=POLLINATOR_COLORS[pol.name]||"#000"; 
    d.style.fontWeight="bold";
    div.appendChild(d);
  });
}

// --- Shop ---
function renderShop(){
  const shopBody=document.getElementById("shopBody"); 
  shopBody.innerHTML="";
  const h=document.createElement("h3"); h.textContent="Plant Shop"; shopBody.appendChild(h);
  PLANTS.forEach(plant=>{
    const btn=document.createElement("button");
    btn.textContent=`Buy ${plant.name} (${plant.cost} seeds) [+${plant.rate}/tick]`;
    btn.addEventListener("click",()=>buyPlant(plant));
    shopBody.appendChild(btn);
  });
  const h2=document.createElement("h3"); h2.textContent="Pollinators"; shopBody.appendChild(h2);
  POLLINATORS.forEach(pol=>{
    const div=document.createElement("div");
    const count=state.pollinators[pol.name]||0;
    div.textContent=`${pol.name}: ${count} (Host: ${pol.host}, Food: ${pol.food})`;
    shopBody.appendChild(div);
  });
}

// --- Main Render ---
function render(){
  const totalPlants=Object.values(state.plants).reduce((a,b)=>a+b,0);
  const uniquePlants=Object.keys(state.plants).filter(p=>state.plants[p]>0).length;
  const diversityMult=1+(uniquePlants-1)*0.1;

  let pollinatorBoost=1;
  for(let pol of POLLINATORS){
    const count=state.pollinators[pol.name]||0;
    pollinatorBoost+=pol.boost*count;
  }

  document.getElementById("seeds").textContent=state.seeds;
  document.getElementById("plants").textContent=totalPlants;
  document.getElementById("pollinators").textContent=Object.keys(state.pollinators).filter(k=>state.pollinators[k]>0).length;
  document.getElementById("stewardship").textContent=Math.floor(state.stewardship);
  document.getElementById("div").textContent=diversityMult.toFixed(1);
  document.getElementById("eco").textContent=state.ecoKnowledge;
  document.getElementById("restored").textContent=state.restored.toLocaleString();

  renderPlantCounts();
  renderPollinatorCounts();
  renderShop();
}

// --- Growth Loop ---
setInterval(()=>{
  checkPollinators();

  let plantSeedGain=0;
  PLANTS.forEach(plant=>{
    const count=state.plants[plant.name]||0;
    plantSeedGain+=count*plant.rate;
  });

  const uniquePlantsCount=Object.keys(state.plants).filter(p=>state.plants[p]>0).length;
  const diversityMult=1+(uniquePlantsCount-1)*0.1;
  const prestigeMult=1+state.ecoKnowledge*0.5;

  state.seeds+=Math.floor(plantSeedGain*pollinatorBoost*diversityMult*prestigeMult);
  state.stewardship+=(Object.keys(state.pollinators).filter(k=>state.pollinators[k]).length*0.5+uniquePlantsCount*0.2)*prestigeMult;

  // Seed to plant conversion (biased toward lower-cost plants)
  if(state.seeds>0){
    state.newSprouts=[];
    const seedsToConvert=Math.min(state.seeds, Math.floor(Math.random()*3)+1);
    for(let i=0;i<seedsToConvert;i++){
      const chosenPlant=choosePlantByWeight(PLANTS);
      state.plants[chosenPlant.name]=(state.plants[chosenPlant.name]||0)+1;
      state.seeds-=1;
      state.newSprouts.push(chosenPlant.name); // track for animation
      if(!firstAutoPlantLogged){
        logEntry(`ğŸŒ¿ A ${chosenPlant.name} has sprouted on its own; life begins to flourish.`, chosenPlant.name);
        firstAutoPlantLogged=true;
      }
    }
  }

  render();
},2000);

// --- Event Listeners ---
document.getElementById("scatterBtn").addEventListener("click",scatter);
document.getElementById("prestigeBtn").addEventListener("click",prestige);

// --- Initial Render ---
render();
</script>
</body>
</html>
